steal.packages({});steal.has("stealconfig.js","steal/build/apps/test/apps_test.js");steal("stealconfig.js","steal/build/apps/test/apps_test.js");steal.pushPending();
steal.config({map:{"*":{"jquery/jquery.js":"jquery",jquery:"lib/jquery/jquery-1.8.3.min.js","jquery-ui/jquery-ui.js":"jquery-ui","jquery-ui":"lib/jquery-ui/jquery-ui.min.js"}},paths:{"models/":"scripts/models/","controllers/":"scripts/controllers/","fixtures/":"scripts/fixtures/"},shim:{jquery:{exports:"jQuery"}},ext:{js:"js",css:"css",ejs:"can/view/ejs/ejs.js"}});steal.executed("stealconfig.js");load("steal/rhino/rhino.js");
steal("steal","steal/test",function(a){a.test.module("steal/build/apps");var c=function(b){load("steal/rhino/rhino.js");steal("steal","steal/build","steal/build/apps",function(c){c.build.apps(["steal/build/apps/test/multibuild/app_x","steal/build/apps/test/multibuild/app_y","steal/build/apps/test/multibuild/app_z"],{});a.test.clear();b();a.test.clear();a.test.remove("steal/build/apps/test/multibuild/app_x/production.js");a.test.remove("steal/build/apps/test/multibuild/app_y/production.js");a.test.remove("steal/build/apps/test/multibuild/app_z/production.js");
a.test.remove("steal/build/apps/test/multibuild/app_x/production.css");a.test.remove("steal/build/apps/test/multibuild/app_y/production.css");a.test.remove("steal/build/apps/test/multibuild/app_z/production.css");a.test.remove("packages/0.js");a.test.remove("packages/1.js");a.test.remove("packages/2.js");a.test.remove("packages/0.css");a.test.remove("packages/1.css");a.test.remove("packages/2.css")})};a.test.test("multibuild creates JS/CSS packages with the right contents",function(){c(function(){var b;
b=readFile("packages/app_x-app_y-app_z.js");a.test.equals(/init_nested_plugin_xyz/.test(b),!0,"content of nested_plugin_xyz.js should be packaged");b=readFile("packages/app_x-app_y.js");a.test.equals(/init_plugin_xy/.test(b),!0,"content of plugin_xy.js should be packaged");b=readFile("packages/app_y-app_z.js");a.test.equals(/init_plugin_yz/.test(b),!0,"content of plugin_yz.js should be packaged");b=readFile("steal/build/apps/test/multibuild/app_x/production.js");a.test.equals(/init_app_x/.test(b),
!0,"content of app_x.js should be packaged");b=readFile("steal/build/apps/test/multibuild/app_y/production.js");a.test.equals(/init_app_y/.test(b),!0,"content of app_y.js should be packaged");b=readFile("steal/build/apps/test/multibuild/app_z/production.js");a.test.equals(/init_app_z/.test(b),!0,"content of app_z.js should be packaged");a.test.equals(/init_plugin_z/.test(b),!0,"content of plugin_z.js should be packaged");b=readFile("packages/app_x-app_y-app_z.css");a.test.equals(/#nested_plugin_xyz_styles/.test(b),
!0,"content of nested_plugin_xyz.css should be packaged");b=readFile("packages/app_x-app_y.css");a.test.equals(/#plugin_xy_styles/.test(b),!0,"content of plugin_xy.css should be packaged");b=readFile("packages/app_y-app_z.css");a.test.equals(/#plugin_yz_styles/.test(b),!0,"content of plugin_yz.css should be packaged");b=readFile("steal/build/apps/test/multibuild/app_x/production.css");a.test.equals(/#app_x_styles/.test(b),!0,"content of app_x.css should be packaged");b=readFile("steal/build/apps/test/multibuild/app_y/production.css");
a.test.equals(/#app_y_styles/.test(b),!0,"content of app_y.css should be packaged");b=readFile("steal/build/apps/test/multibuild/app_z/production.css");a.test.equals(/#app_z_styles/.test(b),!0,"content of app_z.css should be packaged");a.test.equals(/#plugin_z_styles/.test(b),!0,"content of plugin_z.css should be packaged");a.test.open("steal/build/apps/test/multibuild/app_x/app_x.prod.html");b=document.getElementsByTagName("link");a.test.equals(/packages\/app_x-app_y-app_z\.css/.test(b[0].href),
!0,"loaded direct dependencies stylesheet");a.test.equals(/packages\/app_x-app_y\.css/.test(b[1].href),!0,"loaded indirect dependencies stylesheet");a.test.equals(/multibuild\/app_x\/production\.css/.test(b[2].href),!0,"loaded app dependencies stylesheet");a.test.equals(b.length,3,"3 stylesheets are loaded");a.test.equals(modulesLoaded[0],"nested_plugin_xyz","nested_plugin_xyz should have loaded");a.test.equals(modulesLoaded[1],"plugin_xy","plugin_xy should have loaded");a.test.equals(modulesLoaded[2],
"app_x","app_x should have loaded");a.test.clear();a.test.open("steal/build/apps/test/multibuild/app_y/app_y.prod.html");b=document.getElementsByTagName("link");a.test.equals(b.length,4,"4 stylesheets are loaded");a.test.equals(modulesLoaded[0],"nested_plugin_xyz","nested_plugin_xyz should have loaded (just once, even though it's included twice')");a.test.equals(modulesLoaded[1],"plugin_yz","plugin_xy should have loaded");a.test.equals(modulesLoaded[2],"plugin_xy","plugin_yz should have loaded");
a.test.equals(modulesLoaded[3],"app_y","app_y should have loaded");a.test.clear();a.test.open("steal/build/apps/test/multibuild/app_z/app_z.prod.html");b=document.getElementsByTagName("link");a.test.equals(b.length,3,"3 stylesheets are loaded");a.test.equals(modulesLoaded[0],"nested_plugin_xyz","nested_plugin_xyz should have loaded");a.test.equals(modulesLoaded[1],"plugin_yz","plugin_yz should have loaded");a.test.equals(modulesLoaded[2],"plugin_z","plugin_z should have loaded");a.test.equals(modulesLoaded[3],
"app_z","app_z should have loaded")})})});steal.executed("steal/build/apps/test/apps_test.js");steal.popPending();
